Title: Способы завуалированного вызова функции в Assembler
Summary: Рассмотрены различные нестандартные способы вызова функции в Assembler, затрудняющие дизассемблирование.
Date: 2020-12-21
Author: rate1  
Category: Assembler
Tags: assembler, masm32, функция
Slug: sposobi-vizova-funkcii-v-assembler
Status: published
	
Классический способ вызова функции рассмотрен в статье [Функции в Assembler.]({filename}functions-in-assembler.md)  
Вызов функции при использовании макро-команд разбирается в статье [Функции в Assembler с помощью макросов.]({filename}functions-used-macros.md)  

Здесь собраны нестандартные методы вызова процедур, которые служат усложнению чтения исходного кода, для сокрытия вызова функций.  
##Вызов функции с помощью регистров  
Для этого метода необходимо сначала в регистр поместить адрес функции. Адрес функции можно получить при помощи директивы ```offset```.  
>offset - смещение  

Поместим адрес процедуры SubProc в регистр eax и вызовем процедуру через этот регистр:  
```
:::asm
mov eax, offset SubProc
call eax
```
Получаем один из вариантов сокрытия имени процедуры.  
##Эмуляция команды call  
В программе располагается метка сразу после вызова процедуры. Таким образом можно получить адрес возврата из процедуры, т.к. каждая метка, как и имя процедуры, является просто адресом. После этого полученный адрес помещается в стек и командой **jmp** (команда безусловного перехода) осуществляется переход в тело процедуры:  
>jump - прыжок  
```
:::asm
push _next
jmp SubProc
_next:
```  
Теперь попробуем объединить этот метод с предыдущим:  
```
:::asm
push _next
mov eax, offset SubProc
jmp eax
```  
##Вызов функции с помощью команды ret  
```
:::asm
push _next
push offset SubProc
ret
```  
Сначала в стек помещается адрес возврата (метка _next). После этого в стек помещается адрес процедуры SubProc, после этого следует команда **ret**, которая переходит по верхнему адресу из стека (где у нас находится адрес процедуры SubProc).
